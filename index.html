<div>
    <div class="top_row">
        
<!-- TOP LEFT -->
        <div class="top_left">
            <div>
                <h3> Test </h3>
                <div class="vitality">
                    <input name="attr_current_health" type="text" value="450" /><span class="max_value" name="attr_max_health"></span><button class="add_max_button" name="act_add_max_health" type="action"> +150 </button><span class="max_count" name="attr_health_count"></span><span class="count_maximum">(13)</span>
                </div>
                <h3> Mana </h3>
                <div class="vitality">
                    <input name="attr_current_mana" type="text" value="5" /><span class="max_value" name="attr_max_mana"></span><button class="add_max_button" name="act_add_max_mana" type="action"> +1 </button><span class="max_count" name="attr_mana_count"></span><span class="count_maximum">(<span name="attr_level"></span>)</span>
                </div>
            </div>
            <div class="weapon">

            </div>
        </div>

<!-- TOP MID -->
        <div class="top_mid">
            <div class="stats">
                <div class="stat">
                    <span class="stat_name"> Strength </span><span class="stat_max" name="attr_max_strength"></span><span class="percent"></span><button class="add_max_button" name="act_add_max_strength" type="action"> +7 </button><span class="max_count" name="attr_strength_count"></span><span class="count_maximum">(13)</span>
                </div>
                <div class="stat">
                    <span class="stat_name"> Ability Power </span><span class="stat_max" name="attr_max_ability_power"></span><span class="percent"></span><button class="add_max_button" name="act_add_max_ability_power" type="action"> +1 </button><span class="max_count" name="attr_ability_power_count"></span><span class="count_maximum"></span>
                </div>
                <div class="stat">
                    <span class="stat_name"> Reflex </span><span class="stat_max" name="attr_max_reflex"></span><span class="percent"></span><button class="add_max_button" name="act_add_max_reflex" type="action"> +3 </button><span class="max_count" name="attr_reflex_count"></span><span class="count_maximum">(13)</span>
                </div>
                <div class="stat">
                    <span class="stat_name"> Defense </span><span class="stat_max" name="attr_max_defense"></span><span class="percent"></span><button class="add_max_button" name="act_add_max_defense" type="action"> +3 </button><span class="max_count" name="attr_defense_count"></span><span class="count_maximum">(13)</span>
                </div>
                <div class="stat">
                    <span class="stat_name"> Resistance </span><span class="stat_max" name="attr_max_resistance"></span><span class="percent">%</span><button class="add_max_button" name="act_add_max_resistance" type="action"> +20% </button><span class="max_count" name="attr_resistance_count"></span><span class="count_maximum">(<span name="attr_level"></span>)</span>
                </div>
            </div>
        </div>

<!-- TOP RIGHT -->
        <div class="top_right">
            <div class="level_field">
                <div class="xp_field">
                    <div class="xp">
                        <span name="attr_xp"></span>|<span name="attr_needed_xp"></span>
                    </div>
                    <button name="act_buy_xp" type="action"> Buy XP </button>
                </div>
                <button class="begin_session" name="act_begin_session" type="action"> Begin session </button>
                <span class="level" name="attr_level"></span>
                <div class="session_number">
                    Session: <span name="attr_session_number"></span>
                </div>
            </div>

            <div class="resource_field">
                <div class="tp">
                    <span> Talent Points </span>
                    <input name="attr_talent_points" type="number" value="119" />
                </div>
                <div class="ad">
                    <span> Adaptive Development </span>
                    <input name="attr_adaptive_development" type="number" value="0" />
                </div>
                <div class="sp">
                    <span> Skill Points </span>
                    <input name="attr_skill_points" type="number" value="0" />
                </div>
            </div>

        </div>
    </div>

    <div class="bottom_row">
<!-- PHYSICAL TALENTS -->
        <div class="talents_category">
            <div class="talent_top">
                <h2> Physical </h2>
                <div class="talent_percent">
                    <button class="talent_rolling" name="act_roll_physical" type="roll" value="/me : @{character_name} rolled Physical \n--@{physical}--\n/r 1d100"><span name="attr_physical"></span><p>%</p></button>
                    <button class="talent_plus" name="act_add_physical" type="action"> +2.5% </button><span class="max_count" name="attr_physical_count"></span><span class="count_maximum">(13)</span>
                </div>
            </div>
            <div class="talent_critical">
                <span name="attr_physical_crit"></span><span>%</span><button class="talent_plus" name="act_add_physical_crit" type="action"> +4% </button><span class="max_count" name="attr_physical_crit_count"></span><span class="count_maximum">(13)</span>
            </div>
            <table>
                <tr>
                    <th></th>
                    <th> Name </th>
                    <th> Level </th>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_p1_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_p1">
                            <option value=""> Select talent </option>
                            <option value="Assassin"> Assassin </option>
                            <option value="Brawler"> Brawler </option>
                            <option value="Claws&Fangs"> Claws&Fangs </option>
                            <option value="Craft"> Craft </option>
                            <option value="Flight"> Flight </option>
                            <option value="Forge"> Forge </option>
                            <option value="Furtiveness"> Furtiveness </option>
                            <option value="Knight"> Knight </option>
                            <option value="Lancer"> Lancer </option>
                            <option value="Marksman"> Marksman </option>
                            <option value="Mine"> Mine </option>
                            <option value="Mold"> Mold </option>
                            <option value="Movement"> Movement </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Parkour"> Parkour </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Sail"> Sail </option>
                            <option value="Soldier"> Soldier </option>
                            <option value="Swim"> Swim </option>
                            <option value="Thief"> Thief </option>
                            <option value="Throw&Catch"> Throw&Catch </option>
                            <option value="Tinker"> Tinker </option>
                            <option value="Vanguard"> Vanguard </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_p1_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_p1" type="roll" value="/me : @{character_name} used @{p1} \n/r 1d20+@{p1_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_p2_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_p2">
                            <option value=""> Select talent </option>
                            <option value="Assassin"> Assassin </option>
                            <option value="Brawler"> Brawler </option>
                            <option value="Claws&Fangs"> Claws&Fangs </option>
                            <option value="Craft"> Craft </option>
                            <option value="Flight"> Flight </option>
                            <option value="Forge"> Forge </option>
                            <option value="Furtiveness"> Furtiveness </option>
                            <option value="Knight"> Knight </option>
                            <option value="Lancer"> Lancer </option>
                            <option value="Marksman"> Marksman </option>
                            <option value="Mine"> Mine </option>
                            <option value="Mold"> Mold </option>
                            <option value="Movement"> Movement </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Parkour"> Parkour </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Sail"> Sail </option>
                            <option value="Soldier"> Soldier </option>
                            <option value="Swim"> Swim </option>
                            <option value="Thief"> Thief </option>
                            <option value="Throw&Catch"> Throw&Catch </option>
                            <option value="Tinker"> Tinker </option>
                            <option value="Vanguard"> Vanguard </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_p2_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_p2" type="roll" value="/me : @{character_name} used @{p2} \n/r 1d20+@{p2_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_p3_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_p3">
                            <option value=""> Select talent </option>
                            <option value="Assassin"> Assassin </option>
                            <option value="Brawler"> Brawler </option>
                            <option value="Claws&Fangs"> Claws&Fangs </option>
                            <option value="Craft"> Craft </option>
                            <option value="Flight"> Flight </option>
                            <option value="Forge"> Forge </option>
                            <option value="Furtiveness"> Furtiveness </option>
                            <option value="Knight"> Knight </option>
                            <option value="Lancer"> Lancer </option>
                            <option value="Marksman"> Marksman </option>
                            <option value="Mine"> Mine </option>
                            <option value="Mold"> Mold </option>
                            <option value="Movement"> Movement </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Parkour"> Parkour </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Sail"> Sail </option>
                            <option value="Soldier"> Soldier </option>
                            <option value="Swim"> Swim </option>
                            <option value="Thief"> Thief </option>
                            <option value="Throw&Catch"> Throw&Catch </option>
                            <option value="Tinker"> Tinker </option>
                            <option value="Vanguard"> Vanguard </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_p3_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_p3" type="roll" value="/me : @{character_name} used @{p3} \n/r 1d20+@{p3_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_p4_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_p4">
                            <option value=""> Select talent </option>
                            <option value="Assassin"> Assassin </option>
                            <option value="Brawler"> Brawler </option>
                            <option value="Claws&Fangs"> Claws&Fangs </option>
                            <option value="Craft"> Craft </option>
                            <option value="Flight"> Flight </option>
                            <option value="Forge"> Forge </option>
                            <option value="Furtiveness"> Furtiveness </option>
                            <option value="Knight"> Knight </option>
                            <option value="Lancer"> Lancer </option>
                            <option value="Marksman"> Marksman </option>
                            <option value="Mine"> Mine </option>
                            <option value="Mold"> Mold </option>
                            <option value="Movement"> Movement </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Parkour"> Parkour </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Sail"> Sail </option>
                            <option value="Soldier"> Soldier </option>
                            <option value="Swim"> Swim </option>
                            <option value="Thief"> Thief </option>
                            <option value="Throw&Catch"> Throw&Catch </option>
                            <option value="Tinker"> Tinker </option>
                            <option value="Vanguard"> Vanguard </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_p4_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_p4" type="roll" value="/me : @{character_name} used @{p4} \n/r 1d20+@{p4_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_p5_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_p5">
                            <option value=""> Select talent </option>
                            <option value="Assassin"> Assassin </option>
                            <option value="Brawler"> Brawler </option>
                            <option value="Claws&Fangs"> Claws&Fangs </option>
                            <option value="Craft"> Craft </option>
                            <option value="Flight"> Flight </option>
                            <option value="Forge"> Forge </option>
                            <option value="Furtiveness"> Furtiveness </option>
                            <option value="Knight"> Knight </option>
                            <option value="Lancer"> Lancer </option>
                            <option value="Marksman"> Marksman </option>
                            <option value="Mine"> Mine </option>
                            <option value="Mold"> Mold </option>
                            <option value="Movement"> Movement </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Parkour"> Parkour </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Sail"> Sail </option>
                            <option value="Soldier"> Soldier </option>
                            <option value="Swim"> Swim </option>
                            <option value="Thief"> Thief </option>
                            <option value="Throw&Catch"> Throw&Catch </option>
                            <option value="Tinker"> Tinker </option>
                            <option value="Vanguard"> Vanguard </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_p5_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_p5" type="roll" value="/me : @{character_name} used @{p5} \n/r 1d20+@{p5_level}"></button> 
                    </td>
                </tr>
            </table>
        </div>

<!-- MENTAL TALENTS -->
        <div class="talents_category">
            <div class="talent_top">
                <h2> Mental </h2>
                <div class="talent_percent">
                    <button class="talent_rolling" name="act_roll_mental" type="roll" value="/me : @{character_name} rolled Mental \n--@{mental}--\n/r 1d100"><span name="attr_mental"></span><p>%</p></button>
                    <button class="talent_plus" name="act_add_mental" type="action"> +2.5% </button><span class="max_count" name="attr_mental_count"></span><span class="count_maximum">(13)</span>
                </div>
            </div>
            <div class="talent_critical">
                <span name="attr_mental_crit"></span><span>%</span><button class="talent_plus" name="act_add_mental_crit" type="action"> +4% </button><span class="max_count" name="attr_mental_crit_count"></span><span class="count_maximum">(13)</span>
            </div>
            <table>
                <tr>
                    <!-- <th> Rank&nbsp </th> -->
                    <th></th>
                    <th> Name </th>
                    <th> Level </th>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_m1_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_m1">
                            <option value=""> Select talent </option>
                            <option value="Adaptation"> Adaptation </option>
                            <option value="Art"> Art </option>
                            <option value="Awareness"> Awareness </option>
                            <option value="Brew"> Brew </option>
                            <option value="Cook"> Cook </option>
                            <option value="Fabled"> Fabled </option>
                            <option value="Fauna"> Fauna </option>
                            <option value="Flora"> Flora </option>
                            <option value="Herbs"> Herbs </option>
                            <option value="Maledicti"> Maledicti </option>
                            <option value="MartialArts"> Martial Arts </option>
                            <option value="Materials"> Materials </option>
                            <option value="Medicine"> Medicine </option>
                            <option value="Mystic"> Mystic </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="StasiVoli"> Stasi Voli </option>
                            <option value="Tactics"> Tactics </option>
                            <option value="Tools"> Tools </option>
                            <option value="Vocabulary"> Vocabulary </option>
                            <option value="Weaponist"> Weaponist </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_m1_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_m1" type="roll" value="/me : @{character_name} used @{m1} \n/r 1d20+@{m1_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_m2_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_m2">
                            <option value=""> Select talent </option>
                            <option value="Adaptation"> Adaptation </option>
                            <option value="Art"> Art </option>
                            <option value="Awareness"> Awareness </option>
                            <option value="Brew"> Brew </option>
                            <option value="Cook"> Cook </option>
                            <option value="Fabled"> Fabled </option>
                            <option value="Fauna"> Fauna </option>
                            <option value="Flora"> Flora </option>
                            <option value="Herbs"> Herbs </option>
                            <option value="Maledicti"> Maledicti </option>
                            <option value="MartialArts"> Martial Arts </option>
                            <option value="Materials"> Materials </option>
                            <option value="Medicine"> Medicine </option>
                            <option value="Mystic"> Mystic </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="StasiVoli"> Stasi Voli </option>
                            <option value="Tactics"> Tactics </option>
                            <option value="Tools"> Tools </option>
                            <option value="Vocabulary"> Vocabulary </option>
                            <option value="Weaponist"> Weaponist </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_m2_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_m2" type="roll" value="/me : @{character_name} used @{m2} \n/r 1d20+@{m2_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_m3_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_m3">
                            <option value=""> Select talent </option>
                            <option value="Adaptation"> Adaptation </option>
                            <option value="Art"> Art </option>
                            <option value="Awareness"> Awareness </option>
                            <option value="Brew"> Brew </option>
                            <option value="Cook"> Cook </option>
                            <option value="Fabled"> Fabled </option>
                            <option value="Fauna"> Fauna </option>
                            <option value="Flora"> Flora </option>
                            <option value="Herbs"> Herbs </option>
                            <option value="Maledicti"> Maledicti </option>
                            <option value="MartialArts"> Martial Arts </option>
                            <option value="Materials"> Materials </option>
                            <option value="Medicine"> Medicine </option>
                            <option value="Mystic"> Mystic </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="StasiVoli"> Stasi Voli </option>
                            <option value="Tactics"> Tactics </option>
                            <option value="Tools"> Tools </option>
                            <option value="Vocabulary"> Vocabulary </option>
                            <option value="Weaponist"> Weaponist </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_m3_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_m3" type="roll" value="/me : @{character_name} used @{m3} \n/r 1d20+@{m3_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_m4_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_m4">
                            <option value=""> Select talent </option>
                            <option value="Adaptation"> Adaptation </option>
                            <option value="Art"> Art </option>
                            <option value="Awareness"> Awareness </option>
                            <option value="Brew"> Brew </option>
                            <option value="Cook"> Cook </option>
                            <option value="Fabled"> Fabled </option>
                            <option value="Fauna"> Fauna </option>
                            <option value="Flora"> Flora </option>
                            <option value="Herbs"> Herbs </option>
                            <option value="Maledicti"> Maledicti </option>
                            <option value="MartialArts"> Martial Arts </option>
                            <option value="Materials"> Materials </option>
                            <option value="Medicine"> Medicine </option>
                            <option value="Mystic"> Mystic </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="StasiVoli"> Stasi Voli </option>
                            <option value="Tactics"> Tactics </option>
                            <option value="Tools"> Tools </option>
                            <option value="Vocabulary"> Vocabulary </option>
                            <option value="Weaponist"> Weaponist </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_m4_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_m4" type="roll" value="/me : @{character_name} used @{m4} \n/r 1d20+@{m4_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_m5_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_m5">
                            <option value=""> Select talent </option>
                            <option value="Adaptation"> Adaptation </option>
                            <option value="Art"> Art </option>
                            <option value="Awareness"> Awareness </option>
                            <option value="Brew"> Brew </option>
                            <option value="Cook"> Cook </option>
                            <option value="Fabled"> Fabled </option>
                            <option value="Fauna"> Fauna </option>
                            <option value="Flora"> Flora </option>
                            <option value="Herbs"> Herbs </option>
                            <option value="Maledicti"> Maledicti </option>
                            <option value="MartialArts"> Martial Arts </option>
                            <option value="Materials"> Materials </option>
                            <option value="Medicine"> Medicine </option>
                            <option value="Mystic"> Mystic </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="StasiVoli"> Stasi Voli </option>
                            <option value="Tactics"> Tactics </option>
                            <option value="Tools"> Tools </option>
                            <option value="Vocabulary"> Vocabulary </option>
                            <option value="Weaponist"> Weaponist </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_m5_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_m5" type="roll" value="/me : @{character_name} used @{m5} \n/r 1d20+@{m5_level}"></button> 
                    </td>
                </tr>
            </table>
        </div>

<!-- SOCIAL TALENTS -->
        <div class="talents_category">
            <div class="talent_top">
                <h2> Social </h2>
                <div class="talent_percent">
                    <button class="talent_rolling" name="act_roll_social" type="roll" value="/me : @{character_name} rolled Social \n--@{social}--\n/r 1d100"><span name="attr_social"></span><p>%</p></button>
                    <button class="talent_plus" name="act_add_social" type="action"> +2.5% </button><span class="max_count" name="attr_social_count"></span><span class="count_maximum">(13)</span>
                </div>
            </div>
            <div class="talent_critical">
                <span name="attr_social_crit"></span><span>%</span><button class="talent_plus" name="act_add_social_crit" type="action"> +4% </button><span class="max_count" name="attr_social_crit_count"></span><span class="count_maximum">(13)</span>
            </div>
            <table>
                <tr>
                    <!-- <th> Rank&nbsp&nbsp </th> -->
                    <th></th>
                    <th> Name </th>
                    <th> Level </th>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_s1_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_s1">
                            <option value=""> Select talent </option>
                            <option value="Act"> Act </option>
                            <option value="AnimalHandling"> Animal Handling </option>
                            <option value="Appearance"> Appearance </option>
                            <option value="Cavalry"> Cavalry </option>
                            <option value="Charisma"> Charisma </option>
                            <option value="Diplomacy"> Diplomacy </option>
                            <option value="Expression"> Expression </option>
                            <option value="Humor"> Humor </option>
                            <option value="Language"> Language </option>
                            <option value="Music"> Music </option>
                            <option value="Noble"> Noble </option>
                            <option value="Nurse"> Nurse </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Perception"> Perception </option>
                            <option value="Profile"> Profile </option>
                            <option value="Self-Control"> Self-Control </option>
                            <option value="Teach"> Teach </option>
                            <option value="Tribal"> Tribal </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_s1_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_s1" type="roll" value="/me : @{character_name} used @{s1} \n/r 1d20+@{s1_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_s2_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_s2">
                            <option value=""> Select talent </option>
                            <option value="Act"> Act </option>
                            <option value="AnimalHandling"> Animal Handling </option>
                            <option value="Appearance"> Appearance </option>
                            <option value="Cavalry"> Cavalry </option>
                            <option value="Charisma"> Charisma </option>
                            <option value="Diplomacy"> Diplomacy </option>
                            <option value="Expression"> Expression </option>
                            <option value="Humor"> Humor </option>
                            <option value="Language"> Language </option>
                            <option value="Music"> Music </option>
                            <option value="Noble"> Noble </option>
                            <option value="Nurse"> Nurse </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Perception"> Perception </option>
                            <option value="Profile"> Profile </option>
                            <option value="Self-Control"> Self-Control </option>
                            <option value="Teach"> Teach </option>
                            <option value="Tribal"> Tribal </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_s2_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_s2" type="roll" value="/me : @{character_name} used @{s2} \n/r 1d20+@{s2_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_s3_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_s3">
                            <option value=""> Select talent </option>
                            <option value="Act"> Act </option>
                            <option value="AnimalHandling"> Animal Handling </option>
                            <option value="Appearance"> Appearance </option>
                            <option value="Cavalry"> Cavalry </option>
                            <option value="Charisma"> Charisma </option>
                            <option value="Diplomacy"> Diplomacy </option>
                            <option value="Expression"> Expression </option>
                            <option value="Humor"> Humor </option>
                            <option value="Language"> Language </option>
                            <option value="Music"> Music </option>
                            <option value="Noble"> Noble </option>
                            <option value="Nurse"> Nurse </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Perception"> Perception </option>
                            <option value="Profile"> Profile </option>
                            <option value="Self-Control"> Self-Control </option>
                            <option value="Teach"> Teach </option>
                            <option value="Tribal"> Tribal </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_s3_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_s3" type="roll" value="/me : @{character_name} used @{s3} \n/r 1d20+@{s3_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_s4_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_s4">
                            <option value=""> Select talent </option>
                            <option value="Act"> Act </option>
                            <option value="AnimalHandling"> Animal Handling </option>
                            <option value="Appearance"> Appearance </option>
                            <option value="Cavalry"> Cavalry </option>
                            <option value="Charisma"> Charisma </option>
                            <option value="Diplomacy"> Diplomacy </option>
                            <option value="Expression"> Expression </option>
                            <option value="Humor"> Humor </option>
                            <option value="Language"> Language </option>
                            <option value="Music"> Music </option>
                            <option value="Noble"> Noble </option>
                            <option value="Nurse"> Nurse </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Perception"> Perception </option>
                            <option value="Profile"> Profile </option>
                            <option value="Self-Control"> Self-Control </option>
                            <option value="Teach"> Teach </option>
                            <option value="Tribal"> Tribal </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_s4_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_s4" type="roll" value="/me : @{character_name} used @{s4} \n/r 1d20+@{s4_level}"></button> 
                    </td>
                </tr>
                <tr>
                    <td class="talent_short"> 
                        <span class="talent_rank" name="attr_s5_rank"></span> 
                    </td>
                    <td class="talent_long"> 
                        <select class="talent_name" name="attr_s5">
                            <option value=""> Select talent </option>
                            <option value="Act"> Act </option>
                            <option value="AnimalHandling"> Animal Handling </option>
                            <option value="Appearance"> Appearance </option>
                            <option value="Cavalry"> Cavalry </option>
                            <option value="Charisma"> Charisma </option>
                            <option value="Diplomacy"> Diplomacy </option>
                            <option value="Expression"> Expression </option>
                            <option value="Humor"> Humor </option>
                            <option value="Language"> Language </option>
                            <option value="Music"> Music </option>
                            <option value="Noble"> Noble </option>
                            <option value="Nurse"> Nurse </option>
                            <option value="Occupation"> Occupation </option>
                            <option value="Pnaevaru"> Pnaevaru </option>
                            <option value="Perception"> Perception </option>
                            <option value="Profile"> Profile </option>
                            <option value="Self-Control"> Self-Control </option>
                            <option value="Teach"> Teach </option>
                            <option value="Tribal"> Tribal </option>
                        </select> 
                    </td>
                    <td class="talent_very_short"> 
                        <input class="talent_level" name="attr_s5_level" placeholder="X" type="number" /> 
                    </td>
                    <td class="talent_very_short"> 
                        <button class="talent_button" name="roll_s5" type="roll" value="/me : @{character_name} used @{s5} \n/r 1d20+@{s5_level}"></button> 
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <br />
    <span name="attr_traits"></span>

</div>

<input name="attr_level"                type="hidden"   value="1">
<input name="attr_xp"                   type="hidden"   value="0">
<input name="attr_needed_xp"            type="hidden"   value="24">

<input name="attr_session_number"       type="hidden"   value="0">

<input name="attr_max_health"           type="hidden"   value="450">
<input name="attr_max_mana"             type="hidden"   value="5">

<input name="attr_health_count"         type="hidden"   value="0">
<input name="attr_mana_count"           type="hidden"   value="0">

<input name="attr_max_strength"         type="hidden"   value="25">
<input name="attr_max_ability_power"    type="hidden"   value="0">
<input name="attr_max_reflex"           type="hidden"   value="15">
<input name="attr_max_defense"          type="hidden"   value="15">
<input name="attr_max_resistance"       type="hidden"   value="0">

<input name="attr_strength_count"       type="hidden"   value="0">
<input name="attr_ability_power_count"  type="hidden"   value="0">
<input name="attr_reflex_count"         type="hidden"   value="0">
<input name="attr_defense_count"        type="hidden"   value="0">
<input name="attr_resistance_count"     type="hidden"   value="0">

<input name="attr_physical"             type="hidden"   value="10.0">
<input name="attr_mental"               type="hidden"   value="10.0">
<input name="attr_social"               type="hidden"   value="10.0">

<input name="attr_physical_count"       type="hidden"   value="0">
<input name="attr_mental_count"         type="hidden"   value="0">
<input name="attr_social_count"         type="hidden"   value="0">

<input name="attr_physical_crit"        type="hidden"   value="5">
<input name="attr_mental_crit"          type="hidden"   value="5">
<input name="attr_social_crit"          type="hidden"   value="5">

<input name="attr_physical_crit_count"  type="hidden"   value="0">
<input name="attr_mental_crit_count"    type="hidden"   value="0">
<input name="attr_social_crit_count"    type="hidden"   value="0">

<input name="attr_p1_rank"              type="hidden"   value="0">
<input name="attr_p2_rank"              type="hidden"   value="0">
<input name="attr_p3_rank"              type="hidden"   value="0">
<input name="attr_p4_rank"              type="hidden"   value="0">
<input name="attr_p5_rank"              type="hidden"   value="0">
<input name="attr_m1_rank"              type="hidden"   value="0">
<input name="attr_m2_rank"              type="hidden"   value="0">
<input name="attr_m3_rank"              type="hidden"   value="0">
<input name="attr_m4_rank"              type="hidden"   value="0">
<input name="attr_m5_rank"              type="hidden"   value="0">
<input name="attr_s1_rank"              type="hidden"   value="0">
<input name="attr_s2_rank"              type="hidden"   value="0">
<input name="attr_s3_rank"              type="hidden"   value="0">
<input name="attr_s4_rank"              type="hidden"   value="0">
<input name="attr_s5_rank"              type="hidden"   value="0">

<input name="attr_talents"              type="hidden"   value="">
<input name="attr_traits"               type="hidden"   value="">

<script type="text/worker">
    const data = {
        stats: {
            health: {
                name: "health",
                base: 450,
                max: null,
                per_level: 50,
                per_adaptive_development: 150,
                max_adaptive_development: 13
            },
            mana: {
                name: "mana",
                base: 5,
                max: 17,
                per_level: 1,
                per_adaptive_development: 1,
                max_adaptive_development: "level"
            },
            strength: {
                name: "strength",
                base: 25,
                max: null,
                per_level: 3,
                per_adaptive_development: 7,
                max_adaptive_development: 13
            },
            ability_power: {
                name: "ability_power",
                base: 0,
                max: null,
                per_level: 0,
                per_adaptive_development: 1,
                max_adaptive_development: null
            },
            reflex: {
                name: "reflex",
                base: 15,
                max: null,
                per_level: 0,
                per_adaptive_development: 3,
                max_adaptive_development: 13
            },
            defense: {
                name: "defense",
                base: 15,
                max: null,
                per_level: 0,
                per_adaptive_development: 3,
                max_adaptive_development: 13
            },
            resistance: {
                name: "resistance",
                base: 0,
                max: null,
                per_level: 0,
                per_adaptive_development: 20,
                max_adaptive_development: "level"
            }
        },
        talents: {
            rank1talents: ["Art", "Cavalry", "Herbs", "Humor", "Materials", "Mine", "Mold", "Music", "Mystic", "Sail", "Swim", "Tinker", "Vocabulary"],
            rank2talents: ["Act", "Brawler", "Brew", "Claws&Fangs", "Cook", "Flight", "Flora", "Language", "Maledicti", "Noble", "Throw&Catch", "Tools", "Vanguard"],
            rank3talents: ["AnimalHandling", "Appearance", "Craft", "Diplomacy", "Fabled", "Fauna", "Forge", "Marksman", "Medicine", "Movement", "Profile", "Soldier", "Weaponist"],
            rank4talents: ["Awareness", "Charisma", "Expression", "Furtiveness", "Lancer", "Nurse", "Occupation", "Parkour", "Perception", "Self-Control", "StasiVoli", "Thief"],
            rank5talents: ["Adaptation", "Assassin", "Knight", "MartialArts", "Breath", "Cogium", "Might", "Nullify", "Oblige", "Radiance", "Tactics", "Teach", "Tribal", "Pnaevaru"],
        },
        per_session: {
            xp: 4,
            talent_points: 10
        },
        level_requirements: {
            2: 24,
            3: 40,
            4: 60,
            5: 84,
            6: 100
        }
    }

    const get_rank = (talent_name) => {
        if (data.talents.rank1talents.includes(talent_name)) return 1;
        else if (data.talents.rank2talents.includes(talent_name)) return 2;
        else if (data.talents.rank3talents.includes(talent_name)) return 3;
        else if (data.talents.rank4talents.includes(talent_name)) return 4;
        else if (data.talents.rank5talents.includes(talent_name)) return 5;
        else return 0;
    }

    const names = [ "p1", "p2", "p3", "p4", "p5", 
                    "m1", "m2", "m3", "m4", "m5",
                    "s1", "s2", "s3", "s4", "s5"];
    names.forEach(name => {
        on(`change:${name}`, (e) => {
            getAttrs([name, `${name}_level`, "talent_points", "talents"], values => {
                const name_base = values[name];
                const name_rank = get_rank(name_base);
                let talent_list = values["talents"];
                if (talent_list === "") {
                    talent_list = [];
                }

                if (e.previousValue === e.newValue) {
                    talent_list.push(name_base)
                    setAttrs({
                        [`${name}_level`]: 0,
                    });
                } else {
                    const prev_name_rank = get_rank(e.previousValue);
                    const rank_diff = prev_name_rank - name_rank;
                    cost = rank_diff * values[`${name}_level`];
                    const new_tp = int(values["talent_points"]) + cost;

                    const index = talent_list.indexOf(e.previousValue);
                    talent_list[index] = e.newValue;
                    
                    setAttrs({
                        talent_points: new_tp,
                    });
                };
                setAttrs({
                    [`${name}_rank`]: name_rank,
                    talents: talent_list,
                });
            });
        });

        on(`change:${name}_level`, (e) => {
            const previous_value = int(e.previousValue);
            const new_value = int(e.newValue);
            const diff = new_value - previous_value;
            getAttrs(["talent_points", `${name}_rank`, `${name}_level`], (values) => {
                const cost = int(values[`${name}_rank`]) * diff;
                const new_talent_points = int(values["talent_points"]) - cost;
    
                setAttrs({
                    talent_points: new_talent_points
                });
            });
        });
    });

    const trait_list = [
        {name: "Adventurer",        steps: [3,4,5],         count: 0},
        {name: "Ambitious",         steps: [3,6,9],         count: 0},
        {name: "Benevolent",        steps: [3,6,9],         count: 0},
        {name: "Blacksmith",        steps: [2,3,4],         count: 0},
        {name: "Caretaker",         steps: [2,3,4,5],       count: 0},
        {name: "Cartograph",        steps: [2,3,4,5,6,7],   count: 0},
        {name: "Chaotic",           steps: [2,4,5],         count: 0},
        {name: "Corrupt",           steps: [2,3,4],         count: 0},
        {name: "Druid",             steps: [3,5,7],         count: 0},
        {name: "Evil",              steps: [3,5],           count: 0},
        {name: "Expert",            steps: [3,5,7],         count: 0},
        {name: "Forecaster",        steps: [1],             count: 0},
        {name: "Hypocrite",         steps: [2,3,4],         count: 0},
        {name: "Idol",              steps: [3,6],           count: 0},
        {name: "Inquisitive",       steps: [2,4,6],         count: 0},
        {name: "Lawful",            steps: [2,4,6],         count: 0},
        {name: "Magus",             steps: [3],             count: 0},
        {name: "Mastermind",        steps: [1],             count: 0},
        {name: "Pioneer",           steps: [3,5],           count: 0},
        {name: "Prejudice",         steps: [1],             count: 0},
        {name: "Pride",             steps: [3,5,7,9],       count: 0},
        {name: "Race.Human",        steps: [1],             count: 0},
        {name: "Race.Pnaevaru",     steps: [1],             count: 0},
        {name: "Race.Maledicti",    steps: [1,2,3,4,5],     count: 0},
        {name: "Socialite",         steps: [2,4,6],         count: 0},
        {name: "Specialist",        steps: [1],             count: 0},
        {name: "Tradesman",         steps: [2,4,6],         count: 0},
        {name: "Wanderer",          steps: [2,3,4],         count: 0},
        {name: "Weapons.Master",    steps: [3,5],           count: 0},
    ];

    const talent_trait = [ 
        {name: "Art",               rank: 1,    traits: ["Pride", "Tradesman"]}, 
        {name: "Cavalry",           rank: 1,    traits: ["Ambitious", "Caretaker"]}, 
        {name: "Herbs",             rank: 1,    traits: ["Chaotic", "Druid"]}, 
        {name: "Humor",             rank: 1,    traits: ["Idol", "Socialite"]}, 
        {name: "Materials",         rank: 1,    traits: ["Lawful", "Adventurer"]}, 
        {name: "Mine",              rank: 1,    traits: ["Benevolent", "Adventurer"]}, 
        {name: "Mold",              rank: 1,    traits: ["Ambitious", "Blacksmith"]}, 
        {name: "Music",             rank: 1,    traits: ["Idol", "Tradesman"]}, 
        {name: "Mystic",            rank: 1,    traits: ["Evil", "Cartograph"]}, 
        {name: "Sail",              rank: 1,    traits: ["Inquisitive", "Expert"]}, 
        {name: "Swim",              rank: 1,    traits: ["Benevolent", "Wanderer"]}, 
        {name: "Tinker",            rank: 1,    traits: ["Pride", "Druid"]}, 
        {name: "Vocabulary",        rank: 1,    traits: ["Inquisitive", "Cartograph"]},
        {name: "Act",               rank: 2,    traits: ["Hypocrite", "Socialite"]}, 
        {name: "Brawler",           rank: 2,    traits: ["Evil", "Blacksmith"]}, 
        {name: "Brew",              rank: 2,    traits: ["Inquisitive", "Druid"]}, 
        {name: "Claws&Fangs",       rank: 2,    traits: ["Race.Maledicti", "Magus"]}, 
        {name: "Cook",              rank: 2,    traits: ["Lawful", "Caretaker"]}, 
        {name: "Flight",            rank: 2,    traits: ["Race.Maledicti", "Wanderer"]}, 
        {name: "Flora",             rank: 2,    traits: ["Ambitious", "Cartograph"]}, 
        {name: "Language",          rank: 2,    traits: ["Ambitious", "Cartograph"]}, 
        {name: "Maledicti",         rank: 2,    traits: ["Corrupt", "Pioneer"]}, 
        {name: "Noble",             rank: 2,    traits: ["Pride", "Tradesman"]}, 
        {name: "Throw&Catch",       rank: 2,    traits: ["Benevolent", "Pioneer"]}, 
        {name: "Tools",             rank: 2,    traits: ["Chaotic", "Adventurer"]}, 
        {name: "Vanguard",          rank: 2,    traits: ["Benevolent", "Weapons.Master"]},
        {name: "AnimalHandling",    rank: 3,    traits: ["Chaotic", "Caretaker"]}, 
        {name: "Appearance",        rank: 3,    traits: ["Hypocrite", "Expert"]}, 
        {name: "Craft",             rank: 3,    traits: ["Idol", "Pioneer"]}, 
        {name: "Diplomacy",         rank: 3,    traits: ["Corrupt", "Tradesman"]}, 
        {name: "Fabled",            rank: 3,    traits: ["Race.Maledicti", "Cartograph"]}, 
        {name: "Fauna",             rank: 3,    traits: ["Pride", "Cartograph"]}, 
        {name: "Forge",             rank: 3,    traits: ["Benevolent", "Blacksmith"]}, 
        {name: "Marksman",          rank: 3,    traits: ["Pride", "Weapons.Master"]}, 
        {name: "Medicine",          rank: 3,    traits: ["Benevolent", "Druid"]}, 
        {name: "Movement",          rank: 3,    traits: ["Ambitious", "Wanderer"]}, 
        {name: "Profile",           rank: 3,    traits: ["Inquisitive", "Socialite"]}, 
        {name: "Soldier",           rank: 3,    traits: ["Lawful", "Weapons.Master"]}, 
        {name: "Weaponist",         rank: 3,    traits: ["Evil", "Expert"]},
        {name: "Awareness",         rank: 4,    traits: ["Lawful", "Druid"]},
        {name: "Charisma",          rank: 4,    traits: ["Hypocrite", "Pioneer"]}, 
        {name: "Expression",        rank: 4,    traits: ["Pride", "Socialite"]}, 
        {name: "Furtiveness",       rank: 4,    traits: ["Corrupt", "Adventurer"]}, 
        {name: "Lancer",            rank: 4,    traits: ["Ambitious", "Weapons.Master"]}, 
        {name: "Nurse",             rank: 4,    traits: ["Benevolent", "Caretaker"]}, 
        {name: "Occupation",        rank: 4,    traits: ["Lawful", "Tradesman"]}, 
        {name: "Parkour",           rank: 4,    traits: ["Chaotic", "Wanderer"]}, 
        {name: "Perception",        rank: 4,    traits: ["Inquisitive", "Magus"]}, 
        {name: "Self-Control",      rank: 4,    traits: ["Idol", "Blacksmith"]}, 
        {name: "StasiVoli",         rank: 4,    traits: ["Race.Maledicti", "Expert"]}, 
        {name: "Thief",             rank: 4,    traits: ["Evil", "Adventurer"]},
        {name: "Adaptation",        rank: 5,    traits: ["Pride", "Mastermind"]}, 
        {name: "Assassin",          rank: 5,    traits: ["Evil", "Prejudice", "Weapons.Master"]}, 
        {name: "Knight",            rank: 5,    traits: ["Idol", "Prejudice", "Weapons.Master"]}, 
        {name: "MartialArts",       rank: 5,    traits: ["Chaotic", "Expert"]}, 
        {name: "Breath",            rank: 5,    traits: ["Race.Pnaevaru", "Specialist"]}, 
        {name: "Cogium",            rank: 5,    traits: ["Race.Pnaevaru", "Specialist"]}, 
        {name: "Might",             rank: 5,    traits: ["Race.Pnaevaru", "Specialist"]}, 
        {name: "Nullify",           rank: 5,    traits: ["Race.Pnaevaru", "Specialist"]}, 
        {name: "Oblige",            rank: 5,    traits: ["Race.Pnaevaru", "Specialist"]}, 
        {name: "Radiance",          rank: 5,    traits: ["Race.Pnaevaru", "Specialist"]}, 
        {name: "Tactics",           rank: 5,    traits: ["Ambitious", "Magus", "Forecaster"]}, 
        {name: "Teach",             rank: 5,    traits: ["Benevolent", "Socialite"]}, 
        {name: "Tribal",            rank: 5,    traits: ["Race.Maledicti", "Race.Pnaevaru", "Tradesman"]}, 
        {name: "Pnaevaru",          rank: 5,    traits: ["Race.Pnaevaru", "Specialist"]}
    ];

    on('sheet:opened change:talents', (e) => {
        for (const trait of trait_list) {
            trait.count = 0;
        }
        getAttrs(["talents", "traits"], (values) => {
            for (const talent of values["talents"]) {
                const foundTalent = talent_trait.find((item) => item.name === talent);
                if (foundTalent) {
                  const traits = foundTalent.traits;
                  for (const trait of traits) {
                    trait_list.find(it => it.name === trait).count++;
                  }
                }
            };
            const trait_arr = [];
            for (const trait of trait_list) {
                if (trait.count > 0) {
                    trait_arr.push(trait.name + "(" + trait.count + ")");
                }
            };
            setAttrs({
                traits: trait_arr,
            });
        });
    });

    const int = score => parseInt(score, 10) || 0;
    const float = score => parseFloat(score, 10) || 0;

    on('clicked:add_max_health clicked:add_max_mana clicked:add_max_strength clicked:add_max_ability_power clicked:add_max_reflex clicked:add_max_defense clicked:add_max_resistance', async(event) => {
        const stat_kind_max = event.triggerName.substring(12);
        const stat_kind = stat_kind_max.substring(4);
        getAttrs([`${stat_kind_max}`, `${stat_kind}_count`, "adaptive_development", "level"], (values) => {
            const current_max = int(values[`${stat_kind_max}`]);
            const current_count = int(values[`${stat_kind}_count`]);
            let allowed_max = data.stats[`${stat_kind}`].max;
            if (allowed_max === null) {
                allowed_max = current_max + 1;
            }
            let allowed_count = data.stats[`${stat_kind}`].max_adaptive_development;
            if (allowed_count === "level") {
                allowed_count = int(values["level"]);
            }
            else if (allowed_count === null) {
                allowed_count = current_count + 1;
            }

            const can_add = values["adaptive_development"] > 0 && current_max < allowed_max && current_count < allowed_count;
            if (can_add) {
                const new_ad = int(values["adaptive_development"]) - 1;
                const new_count = current_count + 1;
                const new_max = current_max + data.stats[stat_kind].per_adaptive_development;
                setAttrs({
                    adaptive_development: new_ad,
                    [`${stat_kind}_count`]: new_count,
                    [stat_kind_max]: new_max
                });
            }
        });
    });

    on('clicked:add_physical clicked:add_mental clicked:add_social', async(event) => {
        const talent_kind = event.triggerName.substring(12);
        getAttrs([`${talent_kind}`, "adaptive_development", `${talent_kind}_count`], (values) => {
            if (values["adaptive_development"] > 0 && int(values[`${talent_kind}_count`]) < 13) {
                const tal = float(values[`${talent_kind}`]);
                const new_tal = tal + 2.5;
                const new_ad = int(values["adaptive_development"]) - 1;
                const new_count = int(values[`${talent_kind}_count`]) + 1;
                setAttrs({
                    [talent_kind]: new_tal,
                    [`${talent_kind}_count`]: new_count,
                    adaptive_development: new_ad
                });
            }
            
        });
    });

    on('clicked:add_physical_crit clicked:add_mental_crit clicked:add_social_crit', async(event) => {
        const talent_kind = event.triggerName.substring(12);
        getAttrs([`${talent_kind}`, "adaptive_development", `${talent_kind}_count`], (values) => {
            if (values["adaptive_development"] > 0 && int(values[`${talent_kind}_count`]) < 13) {
                const tal = int(values[`${talent_kind}`]);
                const new_tal = tal + 4;
                const new_ad = int(values["adaptive_development"]) - 1;
                const new_count = int(values[`${talent_kind}_count`]) + 1;
                setAttrs({
                    [talent_kind]: new_tal,
                    [`${talent_kind}_count`]: new_count,
                    adaptive_development: new_ad
                });
            }
            
        });
    });

    on('clicked:buy_xp', async(event) => {
        getAttrs(["talent_points", "xp", "level"], (values) => {
            const tp = int(values["talent_points"]);
            if (tp >= 4 && values["level"] < 6) {
                const new_tp = tp - 4;
                const new_xp = int(values["xp"]) + 4;
                setAttrs({
                    talent_points: new_tp,
                    xp: new_xp
                });
            }
        });
    });

    on('clicked:begin_session', async(event) => {
        getAttrs(["talent_points", "xp", "session_number", "level"], (values) => {
            const tp = values["talent_points"];
            let taxes = 0;
            if (tp >= 50) taxes = 5;
            else if (tp >= 40 && tp < 50) taxes = 4;
            else if (tp >= 30 && tp < 40) taxes = 3;
            else if (tp >= 20 && tp < 30) taxes = 2;
            else if (tp >= 10 && tp < 20) taxes = 1;

            const new_tp = int(values["talent_points"]) + data.per_session["talent_points"] + taxes;
            const new_session_num = int(values["session_number"]) + 1;
            setAttrs({
                talent_points: new_tp,
                session_number: new_session_num
            });

            if (values["level"] < 6) {
                const new_xp = int(values["xp"]) + data.per_session["xp"];
                setAttrs({
                    xp: new_xp,
                });
            }
        });
    });

    on('change:xp', async(event) => {
        getAttrs(["level", "xp", "needed_xp"], (values) => {
            const next_level = int(values["level"]) + 1;
            const xp_for_next_level = data.level_requirements[`${next_level}`];
            if (int(values["xp"]) >= xp_for_next_level) {
                level_up();
                const new_xp = int(values["xp"]) - xp_for_next_level;
                const new_needed_xp = data.level_requirements[`${next_level+1}`]
                setAttrs({
                    xp: new_xp,
                    needed_xp: new_needed_xp
                });
            }
        });
    }); 

    const level_up = () => {
        getAttrs(["level", "max_health", "current_health", "max_mana", "current_mana", "max_strength", "max_ability_power", "max_reflex", "max_defense", "max_resistance"], (values) => {
            const new_level = int(values["level"]) + 1;
            const new_max_health = int(values["max_health"]) + data.stats.health.per_level;
            const new_current_health = int(values["current_health"]) + data.stats.health.per_level;
            const new_max_mana = int(values["max_mana"]) + data.stats.mana.per_level;
            const new_current_mana = int(values["current_mana"]) + data.stats.mana.per_level;
            const new_strength = int(values["max_strength"]) + data.stats.strength.per_level;
            const new_ability_power = int(values["max_ability_power"]) + data.stats.ability_power.per_level;
            const new_reflex = int(values["max_reflex"]) + data.stats.reflex.per_level;
            const new_defense = int(values["max_defense"]) + data.stats.defense.per_level;
            const new_resistance = int(values["max_resistance"]) + data.stats.resistance.per_level;
            setAttrs({
                level: new_level,
                max_health: new_max_health,
                current_health: new_current_health,
                max_mana: new_max_mana,
                current_mana: new_current_mana,
                max_strength: new_strength,
                max_ability_power: new_ability_power,
                max_reflex: new_reflex,
                max_defense: new_defense,
                max_resistance: new_resistance
            });
        });
    }
</script>