<div>
    <!-- <div>
        <h2>Physical Talents</h2>
        Art <input type="number" name="attr_Art" value="0" />
        <button type="roll" name="roll_art" value="/me benutzt Art \n/r 1d20+@{Art}"></button>
    </div> -->
    <div class="talentField">
        <h2>Physical Talents</h2>
        <div class="physicalTalentsHeader">
            <table>
                <th class="talentAspectShortHeader"> Rank </th>
                <th> Name </th>
                <th class="talentAspectShortHeader"> Level </th>
            </table>
        </div>
        <fieldset class="physicalTalentsFS">
            <details class="physicalTalentsDetails">
                <summary class="physicalTalentsSummary">
                    <tr>
                        <!-- <td> <input type="number" class="talentAspectShort" name="attr_p1_rank" value="1" disabled="true"> </td> -->
                        <td> <input type="text" class="talentAspect" name="attr_p1_name"> </td>
                        <!-- <td> <select name="selectTalent" class="talentAspect">
                            <option value=""> Choose talent </option>
                            <option value="Swim"> Swim </option>
                            <option value="Throw&Catch"> Throw & Catch </option>
                            <option value="Knight"> Knight </option>
                        </select> </td> -->
                        <!-- <td> <input type="number" class="talentAspectShort" style="size: 20vm" name="attr_p1_level" value="0"> </td> -->
                        <input name="attr_p1_level" type="number" value="" placeholder="10">
                        <span name="attr_p1_level_rank"></span>
                        <td> <button type="roll" name="roll_p1" value="/me : @{character_name} benutzt @{p1_name} \n/r 1d20+@{p1_level_rank}"></button> </td>
                    </tr> <br />
                    <tr>
                        <td> <input type="text" class="talentAspect" name="attr_p2_name"> </td>
                        <!-- <td> <input type="number" class="talentAspectShort" style="size: 20vm" name="attr_p2_level" value="0"> </td> -->
                        <input name="attr_p2_level" type="number" value="" placeholder="10">
                        <span name="attr_p2_level_rank"></span>
                        <td> <button type="roll" name="roll_p2" value="/me : @{character_name} benutzt @{p2_name} \n/r 1d20+@{p2_level_rank}"></button> </td>
                    </tr>
                </summary>
            </details>
        </fieldset>
    </div>

    <!-- <div class="talentField">
        <h2>Social Talents</h2>
        <div class="physicalTalentsHeader">
            <table>
                <th class="talentAspectShortHeader"> Rank </th>
                <th> Name </th>
                <th class="talentAspectShortHeader"> Level </th>
            </table>
        </div>
        <fieldset class="physicalTalentsFS">
            <details class="physicalTalentsDetails">
                <summary class="physicalTalentsSummary">
                    <tr>
                        <td> <input type="number" class="talentAspectShort" name="attr_s1_rank" value="1" disabled="true"> </td>
                        <td> <input type="text" class="talentAspect" name="attr_s1_name"> </td>
                        <td> <select name="selectTalent" class="talentAspect">
                            <option value=""> Choose talent </option>
                            <option value="Swim"> Swim </option>
                            <option value="Throw&Catch"> Throw & Catch </option>
                            <option value="Knight"> Knight </option>
                        </select> </td>
                        <td> <input type="number" class="talentAspectShort" style="size: 20vm" name="attr_s1_level" value="0"> </td>
                        <td> <button type="roll" name="roll_s1" value="/me : @{character_name} benutzt @{s1_name} \n/r 1d20+@{s1_level}"></button> </td>
                    </tr>
                </summary>
            </details>
        </fieldset>
    </div> -->

    <!-- <div class="talentField">
        <h2>Mental Talents</h2>
        <div class="physicalTalentsHeader">
            <table>
                <th class="talentAspectShortHeader"> Rank </th>
                <th> Name </th>
                <th class="talentAspectShortHeader"> Level </th>
            </table>
        </div>
        <fieldset class="physicalTalentsFS">
            <details class="physicalTalentsDetails">
                <summary class="physicalTalentsSummary">
                    <tr>
                        <td> <input type="number" class="talentAspectShort" name="attr_m1_rank" value="1" disabled="true"> </td>
                        <td> <input type="text" class="talentAspect" name="attr_m1_name"> </td>
                        <td> <select name="selectTalent" class="talentAspect">
                            <option value=""> Choose talent </option>
                            <option value="Swim"> Swim </option>
                            <option value="Throw&Catch"> Throw & Catch </option>
                            <option value="Knight"> Knight </option>
                        </select> </td>
                        <td> <input type="number" class="talentAspectShort" style="size: 20vm" name="attr_m1_level" value="0"> </td>
                        <td> <button type="roll" name="roll_p1" value="/me : @{character_name} benutzt @{m1_name} \n/r 1d20+@{m1_level}"></button> </td>
                    </tr>
                </summary>
            </details>
        </fieldset>
    </div> -->

    <input name="attr_p1_level_rank" type="hidden" value="0">
    <input name="attr_p2_level_rank" type="hidden" value="0">
</div>

<!-- <script type="text/javascript"> -->
<script type="text/worker">
    const int = score => parseInt(score, 10) || 0;

    const stats = ["p1_level", "p2_level"];
    stats.forEach(stat => {
        on(`change:${stat}`, () => {
            getAttrs([stat], values => {
                const stat_base = int(values[stat]);
                console.log(stat_base);
                let stat_rank = 0;
                if (stat_base >= 19) stat_rank = "+4";
                else if (stat_base >= 18) stat_rank = "+3";
                else if (stat_base >= 16) stat_rank = "+2";
                else if (stat_base >= 14) stat_rank = "+1";
                else if (stat_base >= 12) stat_rank = "+0";
                else if (stat_base >= 8) stat_rank = "-1";
                else if (stat_base >= 6) stat_rank = "-2";
                else stat_rank = "-3";
                
                setAttrs({
                    [`${stat}_rank`]: stat_rank
                });
            });
        });
    });
</script>